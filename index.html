<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ojae Editor</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📝</text></svg>">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- 헤더 (바 형태) -->
<header class="main-header">
    <div class="header-left">
        <div class="logo">
            <i class="ph ph-note-pencil"></i>
            <span>Ojae Editor</span>
        </div>
        <button id="btn-help" class="icon-btn" onclick="openHelpModal()" title="도움말"><i class="ph ph-info"></i></button>
    </div>
    <input type="text" id="novel-title" placeholder="전체 제목을 입력하세요">
    <div class="header-right">
        <button id="btn-save" class="header-btn" onclick="openSaveModal()">
            <i class="ph ph-cloud-check"></i>
            <span>저장됨</span>
        </button>
        <div class="header-dropdown">
            <button class="header-btn" onclick="toggleFileDropdown()">
                <i class="ph ph-folder-simple"></i>
                <span>파일</span>
                <i class="ph ph-caret-down" style="font-size: 0.8rem; margin-left: 2px;"></i>
            </button>
            <div id="file-dropdown" class="header-dropdown-menu hidden">
                <button class="dropdown-item" onclick="openImportModal(); closeFileDropdown();">
                    <i class="ph ph-upload-simple"></i>
                    <span>불러오기</span>
                </button>
                <button class="dropdown-item" onclick="openExportModal(); closeFileDropdown();">
                    <i class="ph ph-download-simple"></i>
                    <span>내보내기</span>
                </button>
            </div>
        </div>
        <div class="header-divider"></div>
        <button id="btn-view-mode" class="icon-btn" onclick="toggleView()" title="읽기/쓰기 전환">
            <i class="ph ph-pencil-simple"></i>
        </button>
        <button id="btn-theme" class="icon-btn" onclick="toggleTheme()" title="테마 전환">
            <i class="ph ph-sun"></i>
        </button>
        <button id="btn-fullscreen" class="icon-btn" onclick="toggleFullScreen()" title="전체화면">
            <i class="ph ph-corners-out"></i>
        </button>
        <button id="btn-focus" class="icon-btn" onclick="toggleFocusMode()" title="집중 모드">
            <i class="ph ph-eye"></i>
        </button>
    </div>
</header>

<div class="main-container">
    <div class="editor-wrapper">
        <div class="youtube-panel" id="youtube-panel">
            <div class="panel-header">
                <input type="text" id="youtube-input" class="panel-input" placeholder="YouTube 링크 붙여넣기">
                <div id="radio-label" class="radio-label hidden">
                    <i id="radio-icon" class="ph ph-youtube-logo"></i>
                    <span id="radio-text">YouTube Player</span>
                </div>
                <button id="panel-toggle-btn" class="panel-toggle-btn" onclick="toggleYoutubePanel()" title="접기/펼치기">
                    <i class="ph ph-caret-up"></i>
                </button>
            </div>
            <div class="youtube-content" id="youtube-content">
                <div class="youtube-player">
                    <iframe id="youtube-iframe" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
            </div>
            <div class="resize-handle" id="youtube-resize-handle"></div>
        </div>
        
        <div class="editor-area">
            <div class="section-header">
                <input type="text" id="section-title" placeholder="섹션 제목 (선택사항)">
                <div class="section-controls">
                    <button id="type-toggle-btn" class="control-btn" onclick="toggleSectionType()" title="본문/노트 전환">
                        <i class="ph ph-file-text"></i>
                        <span>본문</span>
                    </button>
                </div>
            </div>
            <textarea id="novel-editor" placeholder="이곳에 글을 쓰면 자동으로 클라우드에 저장됩니다."></textarea>
            <div id="markdown-preview" class="markdown-preview hidden">
                <div class="preview-notice">
                    <i class="ph ph-book-open"></i>
                    <span>읽기 모드</span>
                </div>
                <div id="preview-content"></div>
            </div>
            
            <!-- 상태바 (에디터 바로 아래) -->
            <div class="status-bar">
                <div class="status-left">
                    <button id="goal-toggle-btn" class="goal-toggle-btn" onclick="toggleGoalUI()" title="목표 글자수 설정">
                        <i class="ph ph-target"></i>
                    </button>
                    <div id="goal-display" class="goal-display hidden">
                        <div class="goal-progress-bar">
                            <div id="goal-progress-fill" class="goal-progress-fill"></div>
                        </div>
                        <span id="goal-text" class="goal-text">0 / 1,000</span>
                        <button id="goal-edit-btn" class="goal-edit-btn" onclick="openGoalInput()" title="목표 수정">
                            <i class="ph ph-pencil-simple"></i>
                        </button>
                    </div>
                    <div id="goal-input-area" class="goal-input-area hidden">
                        <input type="number" id="goal-input" class="goal-input" placeholder="목표" min="0" step="100">
                        <span class="goal-input-suffix">자</span>
                        <button class="goal-input-btn" onclick="saveGoal()">확인</button>
                        <button class="goal-input-btn cancel" onclick="cancelGoalInput()">취소</button>
                    </div>
                </div>
                <div class="status-right">
                    <button id="scope-toggle" class="status-toggle-btn" onclick="toggleScope()">현재 섹션</button>
                    <button id="space-toggle" class="status-toggle-btn" onclick="toggleSpace()">공백 포함</button>
                    <span class="char-count-display"><span id="char-count">0</span>자</span>
                </div>
            </div>
        </div>
        
        <div class="section-sidebar">
            <div class="section-list" id="section-list"></div>
            <button class="add-section-btn" onclick="addSection()">+ 새 섹션</button>
            <div class="move-text-wrapper">
                <button id="move-text-btn" onclick="toggleMoveDropdown()" disabled>선택 영역 이동</button>
                <div id="move-dropdown" class="move-dropdown hidden"></div>
            </div>
        </div>
    </div>
</div>

<!-- Import 모달 -->
<div id="import-modal" class="modal hidden">
    <div class="modal-overlay" onclick="closeImportModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>불러오기</h3>
            <button class="modal-close" onclick="closeImportModal()">×</button>
        </div>
        <div class="modal-body">
            <button class="modal-action-btn" onclick="triggerImport(); closeImportModal();">전체 파일 불러오기</button>
            <button class="modal-action-btn" onclick="triggerSectionImport(); closeImportModal();">섹션 파일 불러오기</button>
        </div>
    </div>
</div>

<!-- Export 모달 -->
<div id="export-modal" class="modal hidden">
    <div class="modal-overlay" onclick="closeExportModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>내보내기</h3>
            <button class="modal-close" onclick="closeExportModal()">×</button>
        </div>
        <div class="modal-body">
            <div class="modal-field">
                <label>포맷</label>
                <select id="export-format" onchange="updateFormatDescription()">
                    <option value="json">백업용 (.json)</option>
                    <option value="editable">백업용 (.txt) - 레거시</option>
                    <option value="readable">완성본 (.txt)</option>
                </select>
            </div>
            <div class="modal-field-desc" id="format-desc">불러오기 가능</div>
            <div class="modal-field">
                <label>범위</label>
                <select id="export-scope" onchange="updateScopeDescription()">
                    <option value="all">전체</option>
                    <option value="current">현재 섹션</option>
                </select>
            </div>
            <div class="modal-field-desc" id="scope-desc"></div>
            <button class="modal-submit-btn" onclick="executeExport()">내보내기</button>
        </div>
    </div>
</div>

<!-- Save 모달 -->
<div id="save-modal" class="modal hidden">
    <div class="modal-overlay" onclick="closeSaveModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>저장 및 공유</h3>
            <button class="modal-close" onclick="closeSaveModal()">×</button>
        </div>
        <div class="modal-body">
            <div id="save-modal-status" style="text-align: center; padding: 30px 0 20px 0;">
                <!-- JS에서 상태별로 내용 채움 -->
            </div>
            
            <div class="modal-field" style="flex-direction: column; align-items: stretch; gap: 8px; margin-top: 10px; padding-top: 20px; border-top: 1px solid var(--border-light);">
                <label style="width: 100%; font-size: 13px; font-weight: 600; color: var(--text-secondary);">문서 다시 열기 링크</label>
                <div style="display: flex; gap: 8px;">
                    <input type="text" id="save-link-input" readonly 
                           style="flex: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-tertiary); color: var(--text-primary); font-family: monospace; font-size: 12px;">
                    <button onclick="copySaveLink(event)" 
                            style="padding: 0 18px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 4px; cursor: pointer; color: var(--text-primary); font-weight: 500; white-space: nowrap; transition: background 0.2s;">
                        복사
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Help 모달 -->
<div id="help-modal" class="modal hidden">
    <div class="modal-overlay" onclick="closeHelpModal()"></div>
    <div class="modal-content help-modal-content">
        <div class="modal-header">
            <h3>도움말</h3>
            <button class="modal-close" onclick="closeHelpModal()">×</button>
        </div>
        <div class="modal-body help-modal-body">
            <section class="help-section">
                <h4>Ojae Editor 소개</h4>
                <p>Ojae Editor는 클라우드 기반 글쓰기 도구입니다. 작성한 내용은 자동으로 저장되며, 링크를 통해 어디서든 다시 열 수 있습니다.</p>
            </section>

            <section class="help-section">
                <h4>단축키</h4>
                <div class="shortcut-list">
                    <p class="shortcut-placeholder">준비 중입니다.</p>
                </div>
            </section>
        </div>
    </div>
</div>

<input type="file" id="file-input" accept=".txt,.json" onchange="handleFileSelect(event)">
<input type="file" id="section-file-input" accept=".txt,.json" onchange="handleSectionFileSelect(event)">

<div id="toast">알림</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="script.js"></script>

</body>
</html>
